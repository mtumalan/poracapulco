<!DOCTYPE html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<style>
  .card {
    border: 1px solid #ccc;
    padding: 10px;
    margin: 10px;
    width: 300px;
    display: inline-block;
    text-align: center;
  }
  .card img {
    max-width: 100%;
    max-height: 200px; /* Establece la altura máxima que desees */
    height: auto;
  }
  .update-status {
    text-align: left;
  }
</style>
<div id="data-list"></div>
<select id="filtro-campo">
    <option value="nombre">Nombre de persona desaparecida</option>
    <option value="zona">Zona</option>
</select>
<input type="text" id="filtro-entrada" placeholder="Filtrar por nombre o zona (regex)">
<button id="filtrar-button">Filtrar</button>
<div id="filtered-list"></div>

<script>
    var csvFileURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRo-QOJ6L0_YLK8A5ThIugf6c1AcZE-MGgd_hLuWgRhQKf1HauB3MOEkkfKa7xBMKQwbNGJ9KMWZoI/pub?output=csv"; // Reemplaza con la URL de tu archivo .csv

    function cargarDatos() {
        fetch(csvFileURL)
            .then(function (response) {
                return response.text();
            })
            .then(function (data) {
                Papa.parse(data, {
                    header: true, // Si la primera fila del archivo .csv contiene encabezados de columna
                    complete: function (result) {
                        var dataList = document.getElementById("data-list");
                        var filteredList = document.getElementById("filtered-list");
                        var filtroCampo = document.getElementById("filtro-campo");
                        var filtroEntrada = document.getElementById("filtro-entrada");
                        var filtrarButton = document.getElementById("filtrar-button");

                        function actualizarLista(filtro) {
                            filteredList.innerHTML = ""; // Limpiar la lista filtrada
                            result.data.forEach(function (item) {
                                var nombre = (item["Nombre persona desaparecida"] || "").trim();
                                var zona = (item["Zona"] || "").trim();
                                var foto = (item["Fotografía"] || "").trim();

                                if (
                                    (filtroCampo.value === "nombre" && new RegExp(filtro, 'i').test(nombre)) ||
                                    (filtroCampo.value === "zona" && new RegExp(filtro, 'i').test(zona))
                                ) {
                                    var card = document.createElement("div");
                                    card.className = "card";

                                    // Transforma la URL de Google Drive si es necesario
                                    if (foto && foto.includes("drive.google.com/open?id=")) {
                                        foto = transformarURLGoogleDrive(foto);
                                    }

                                    // Agrega la imagen si está disponible
                                    if (foto) {
                                        var image = document.createElement("img");
                                        image.src = foto;
                                        card.appendChild(image);
                                    }

                                    // Agrega el nombre y la zona como texto
                                    var nombreElement = document.createElement("p");
                                    nombreElement.innerHTML = "<strong>Nombre:</strong> <br>" + nombre;
                                    card.appendChild(nombreElement);

                                    var zonaElement = document.createElement("p");
                                    zonaElement.innerHTML = "<strong>Zona:</strong><br> " + zona;
                                    card.appendChild(zonaElement);

                                    filteredList.appendChild(card);

                                    var updateStatus = document.createElement("button");
                                    updateStatus.className = "update-status";
                                    updateStatus.textContent = "Actualizar estado";
                                    card.appendChild(updateStatus);

                                    card.appendChild(updateStatus);
                                }
                            });
                        }

                        filtrarButton.addEventListener("click", function () {
                            var filtro = filtroEntrada.value;
                            actualizarLista(filtro);
                        });

                        // Mostrar todos los datos al cargar la página
                        actualizarLista("");
                    },
                });
            });
    }

    // Función para transformar la URL de Google Drive
    function transformarURLGoogleDrive(url) {
        var regex = /https:\/\/drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/;
        return url.replace(regex, "https://drive.google.com/uc?export=view&id=$1");
    }

    cargarDatos();
</script>
