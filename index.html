<!DOCTYPE html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<style>
  .card {
    border: 1px solid #ccc;
    padding: 10px;
    margin: 10px;
    width: 300px;
    display: inline-block;
    text-align: center;
  }
  .card img {
    max-width: 100%;
    max-height: 200px; /* Establece la altura máxima que desees */
    height: auto;
  }
  .update-status {
    text-align: left;
  }
</style>
<div id="data-list"></div>
<select id="filtro-campo">
    <option value="nombre">Nombre de persona desaparecida</option>
    <option value="zona">Zona</option>
</select><br><br>
<select id="filtro-zona" style="display: none;">
    <option value="">Seleccionar Zona</option>
    <option value="Alta Progreso">Alta Progreso</option>
    <option value="Barra Vieja">Barra Vieja</option>
    <option value="Bocamar">Bocamar</option>
    <option value="Caleta">Caleta</option>
    <option value="Caletilla">Caletilla</option>
    <option value="Centro">Centro</option>
    <option value="Colosio">Colosio</option>
    <option value="Coloso">Coloso</option>
    <option value="Condesa">Condesa</option>
    <option value="Costa Azul, Icacos">Costa Azul, Icacos</option>
    <option value="Cruces / Cima">Cruces / Cima</option>
    <option value="Cumbres de Figueroa">Cumbres de Figueroa</option>
    <option value="Diamante">Diamante</option>
    <option value="Foviste Alta Progreso">Foviste Alta Progreso</option>
    <option value="Ejido">Ejido</option>
    <option value="El Cayaco / Papagayo">El Cayaco / Papagayo</option>
    <option value="El Roble">El Roble</option>
    <option value="Emiliano Zapata / El Quemado">Emiliano Zapata / El Quemado</option>
    <option value="Farallón">Farallón</option>
    <option value="Hogar Moderno">Hogar Moderno</option>
    <option value="Hornos Insurgentes">Hornos Insurgentes</option>
    <option value="Hospital - La Laja">Hospital - La Laja</option>
    <option value="Jardín y Pie de la Cuesta">Jardín y Pie de la Cuesta</option>
    <option value="Joyas, Brisas, Escénica">Joyas, Brisas, Escénica</option>
    <option value="KM 21, KM 30 y alrededores">KM 21, KM 30 y alrededores</option>
    <option value="Miguel Alemán">Miguel Alemán</option>
    <option value="Morelos">Morelos</option>
    <option value="La Garita">La Garita</option>
    <option value="La Navidad Acapulco">La Navidad Acapulco</option>
    <option value="Las Cruces / Rancho">Las Cruces / Rancho</option>
    <option value="Lerdo de Tejada">Lerdo de Tejada</option>
    <option value="Libertadores">Libertadores</option>
    <option value="Llano Largo">Llano Largo</option>
    <option value="Mozimba">Mozimba</option>
    <option value="Palma Sola">Palma Sola</option>
    <option value="Palomares y Potrerillo">Palomares y Potrerillo</option>
    <option value="Progreso">Progreso</option>
    <option value="Puerto Marqués">Puerto Marqués</option>
    <option value="Renacimiento">Renacimiento</option>
    <option value="Revolcadero / La Poza">Revolcadero / La Poza</option>
    <option value="Zapata / Libertadores / Vacacional">Zapata / Libertadores / Vacacional</option>
    <option value="Zona Hornitos - Hornos">Zona Hornitos - Hornos</option>
    <option value="Sabana">Sabana</option>
</select>
<input type="text" id="filtro-entrada" placeholder="Filtrar por nombre o zona"><br>
<button id="filtrar-button">Filtrar</button>
<button id="reporte" onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSfqtoS1DvwwcNj56MevuQl002A8lKWvwGci-t7OceWkfydtMA/viewform', '_blank')">Crear Reporte</button><div id="filtered-list"></div>

<script>
    var csvFileURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRo-QOJ6L0_YLK8A5ThIugf6c1AcZE-MGgd_hLuWgRhQKf1HauB3MOEkkfKa7xBMKQwbNGJ9KMWZoI/pub?output=csv"; // Reemplaza con la URL de tu archivo .csv

    function cargarDatos() {
        fetch(csvFileURL)
            .then(function (response) {
                return response.text();
            })
            .then(function (data) {
                Papa.parse(data, {
                    header: true, // Si la primera fila del archivo .csv contiene encabezados de columna
                    complete: function (result) {
                        var dataList = document.getElementById("data-list");
                        var filteredList = document.getElementById("filtered-list");
                        var filtroCampo = document.getElementById("filtro-campo");
                        var filtroEntrada = document.getElementById("filtro-entrada");
                        var filtrarButton = document.getElementById("filtrar-button");
                        var filtroZona = document.getElementById("filtro-zona");


                        function actualizarLista(filtro) {
                            filteredList.innerHTML = "";
                            result.data.forEach(function (item) {
                              var nombre = (item["Nombre persona desaparecida"] || "").trim();
                              var zona = (item["Zona"] || "").trim();
                              var foto = (item["Fotografía"] || "").trim();
                          
                              if (
                                (filtroCampo.value === "nombre" && new RegExp(filtro, 'i').test(nombre)) ||
                                (filtroCampo.value === "zona" && new RegExp(filtro, 'i').test(zona))
                              ) {
                                var card = document.createElement("div");
                                card.className = "card";
                          
                                // Transform the Google Drive URL if needed
                                if (foto && foto.includes("drive.google.com/open?id=")) {
                                  foto = transformarURLGoogleDrive(foto);
                                }
                          
                                if (foto) {
                                  var image = document.createElement("img");
                                  image.src = foto;
                                  card.appendChild(image);
                                }
                          
                                var nombreElement = document.createElement("p");
                                nombreElement.innerHTML = "<strong>Nombre:</strong> <br>" + nombre;
                                card.appendChild(nombreElement);
                          
                                var zonaElement = document.createElement("p");
                                zonaElement.innerHTML = "<strong>Zona:</strong><br> " + zona;
                                card.appendChild(zonaElement);
                          
                                filteredList.appendChild(card);
                          
                                var updateStatus = document.createElement("button");
                                updateStatus.className = "update-status";
                                updateStatus.textContent = "Actualizar estado";
                                card.appendChild(updateStatus);
                              }
                            });
                          }
                          
                        filtrarButton.addEventListener("click", function () {
                            if (filtroCampo.value === "nombre") {
                              var filtro = filtroEntrada.value;
                              actualizarLista(filtro);
                            } else if (filtroCampo.value === "zona") {
                              var filtro = filtroZona.value;
                              actualizarLista(filtro);
                            }
                        });

                            // Detect changes in the filtering method
                        filtroCampo.addEventListener("change", function () {
                            if (filtroCampo.value === "zona") {
                                // If Zona is selected, show the Zona selector
                                filtroZona.style.display = "block";
                                filtroEntrada.style.display = "none";
                                filtroEntrada.value = "";
                                var filtro = filtroZona.value;
                                actualizarLista(filtro);
                            } else {
                                // Otherwise, hide the Zona selector
                                filtroZona.style.display = "none";
                                filtroEntrada.style.display = "block";
                                filtroEntrada.value = "";
                                var filtro = filtroEntrada.value;
                                actualizarLista(filtro);
                            }
                        });

                    // Mostrar todos los datos al cargar la página
                    actualizarLista("");
                    },
                });
            });
    }

    // Función para transformar la URL de Google Drive
    function transformarURLGoogleDrive(url) {
        var regex = /https:\/\/drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/;
        return url.replace(regex, "https://drive.google.com/uc?export=view&id=$1");
    }

    cargarDatos();
</script>
